
<!doctype html>
<html lang="hu" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Benedek Zoltán">
      
      
        <link rel="canonical" href="https://bmeviauab00.github.io/szoftvertechnikak/2024/labor/old-7-tervezesi-mintak/">
      
      
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.9">
    
    
      
        <title>7. Tervezési minták - BMEVIAUAB00 Szoftvertechnikák</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f2e4d321.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../css/timeago.css">
    
      <link rel="stylesheet" href="../../extra-material-theme.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="aut" data-md-color-primary="aut" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#7-tervezesi-mintak" class="md-skip">
          Kihagyás
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Élőfej">
    <a href="../.." title="BMEVIAUAB00 Szoftvertechnikák" class="md-header__button md-logo" aria-label="BMEVIAUAB00 Szoftvertechnikák" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            BMEVIAUAB00 Szoftvertechnikák
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              7. Tervezési minták
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="aut" data-md-color-primary="aut" data-md-color-accent="red"  aria-label="Váltás sötét témára"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Váltás sötét témára" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="red" data-md-color-accent="indigo"  aria-label="Váltás világos témára"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Váltás világos témára" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Keresés" placeholder="Keresés" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Keresés">
        
        <button type="reset" class="md-search__icon md-icon" title="Törlés" aria-label="Törlés" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Keresés inicializálása
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/bmeviauab00/szoftvertechnikak" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauab00/szoftvertechnikak
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Lapok" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Szoftvertechnikák (2024-től)

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1-model-es-kod-kapcsolata/" class="md-tabs__link">
          
  
  Laborok

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../hazi/" class="md-tabs__link">
          
  
  Önálló/házi feladatok

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1-model-es-kod-kapcsolata/index_eng/" class="md-tabs__link">
          
  
  English course labs

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../hazi/index_eng/" class="md-tabs__link">
          
  
  Homework

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../1-model-es-kod-kapcsolata/index_ger/" class="md-tabs__link">
          
  
  Deutschkurs-Labore

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../hazi/meghirdetes-elott_ger/" class="md-tabs__link">
          
  
  Hausaufgaben

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigáció" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="BMEVIAUAB00 Szoftvertechnikák" class="md-nav__button md-logo" aria-label="BMEVIAUAB00 Szoftvertechnikák" data-md-component="logo">
      
  <img src="../../img/logo-bme-aut.png" alt="logo">

    </a>
    BMEVIAUAB00 Szoftvertechnikák
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/bmeviauab00/szoftvertechnikak" title="Főoldalra ugrás" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    bmeviauab00/szoftvertechnikak
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Szoftvertechnikák (2024-től)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Laborok
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Laborok
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-model-es-kod-kapcsolata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. A modell és a kód kapcsolata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-nyelvi-eszkozok/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Nyelvi eszközök
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-felhasznaloi-felulet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. A felhasználói felület kialakítása
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-tobbszalu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Többszálú alkalmazások készítése
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-mvvm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-tervezesi-mintak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Tervezési minták (kiterjeszthetőség)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-adatkezeles/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Adatkezelés
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Önálló/házi feladatok
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Önálló/házi feladatok
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Útmutató
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/1-model-es-kod-kapcsolata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. HF - A modell és a kód kapcsolata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/2-nyelvi-eszkozok/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. HF - Nyelvi eszközök
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/3-felhasznaloi-felulet-kialakitasa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. HF - Felhasználói felület kialakítása
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/4-tobbszalu-alkalmazasok-fejlesztese/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. HF - Többszálú alkalmazások fejlesztése
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/5-mvvm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. HF - MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/6-tervezesi-mintak/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. HF - Tervezési minták
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/imsc-liftsystem/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IMSc HF - Liftrendszer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/fejlesztokornyezet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fejlesztőkörnyezet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    English course labs
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            English course labs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-model-es-kod-kapcsolata/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. The relationship between the model and the code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-nyelvi-eszkozok/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Language tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-felhasznaloi-felulet/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. The design of the user interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-tobbszalu/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Developing multithreaded applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-mvvm/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-tervezesi-mintak/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Design patterns (extensibility)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-adatkezeles/index_eng.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    None
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Homework
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Homework
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/1-model-es-kod-kapcsolata/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. HW - The relationship between the model and the code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/2-nyelvi-eszkozok/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. HW - Language tools
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/3-felhasznaloi-felulet-kialakitasa/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. HW - Implementing the user interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/4-tobbszalu-alkalmazasok-fejlesztese/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. HW - Developing multithreaded applications
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/5-mvvm/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. HW - MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/meghirdetes-elott_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. HW - Design patterns
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/meghirdetes-elott_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IMSc HW - Liftsystem
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/fejlesztokornyezet/index_eng/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development environment
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Deutschkurs-Labore
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Deutschkurs-Labore
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../1-model-es-kod-kapcsolata/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Beziehung zwischen dem Modell und dem Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../2-nyelvi-eszkozok/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Sprachliche Mittel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../3-felhasznaloi-felulet/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Entwurf der Benutzeroberfläche
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../4-tobbszalu/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Erstellung von mehrfädigen Anwendungen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../5-mvvm/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../6-tervezesi-mintak/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Entwurfsmuster (Erweiterbarkeit)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../7-adatkezeles/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    7. Datenverwaltung
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Hausaufgaben
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Hausaufgaben
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/meghirdetes-elott_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1. Beziehung zwischen dem Modell und dem Code
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/meghirdetes-elott_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Sprachliche Mittel
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/3-felhasznaloi-felulet-kialakitasa/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Entwurf der Benutzeroberfläche
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/4-tobbszalu-alkalmazasok-fejlesztese/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Entwicklung von Multithreading-Anwendungen
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/5-mvvm/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. MVVM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/6-tervezesi-mintak/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6. Entwurfsmuster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hazi/fejlesztokornyezet/index_ger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Entwicklungsumgebung
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tartalomjegyzék">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tartalomjegyzék
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#a-gyakorlat-celja" class="md-nav__link">
    <span class="md-ellipsis">
      A gyakorlat célja
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elofeltetelek" class="md-nav__link">
    <span class="md-ellipsis">
      Előfeltételek
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#megoldas" class="md-nav__link">
    <span class="md-ellipsis">
      Megoldás
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bevezeto" class="md-nav__link">
    <span class="md-ellipsis">
      Bevezető
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Bevezető">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elmeleti-hatter" class="md-nav__link">
    <span class="md-ellipsis">
      Elméleti háttér
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-feladat-ismertetese" class="md-nav__link">
    <span class="md-ellipsis">
      A feladat ismertetése
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#1-feladat-a-kiindulasi-kornyezet-megismerese" class="md-nav__link">
    <span class="md-ellipsis">
      1. Feladat - A kiindulási környezet megismerése
    </span>
  </a>
  
    <nav class="md-nav" aria-label="1. Feladat - A kiindulási környezet megismerése">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#megvalositando-funkciok" class="md-nav__link">
    <span class="md-ellipsis">
      Megvalósítandó funkciók
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-solution-felepitese" class="md-nav__link">
    <span class="md-ellipsis">
      A solution felépítése
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#document-view-architektura" class="md-nav__link">
    <span class="md-ellipsis">
      Document-View architektúra
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#command-binding" class="md-nav__link">
    <span class="md-ellipsis">
      Command Binding
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-feladat-command-processor-minta" class="md-nav__link">
    <span class="md-ellipsis">
      2. Feladat - Command Processor minta
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2. Feladat - Command Processor minta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-command-processor-minta-koncepcioja" class="md-nav__link">
    <span class="md-ellipsis">
      A Command Processor minta koncepciója
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-command-processor-minta-megvalositasa-alkalmazasunkban" class="md-nav__link">
    <span class="md-ellipsis">
      A Command Processor minta megvalósítása alkalmazásunkban
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-feladat-memento-minta" class="md-nav__link">
    <span class="md-ellipsis">
      3. Feladat – Memento minta
    </span>
  </a>
  
    <nav class="md-nav" aria-label="3. Feladat – Memento minta">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#a-memento-minta-koncepcioja" class="md-nav__link">
    <span class="md-ellipsis">
      A Memento minta koncepciója
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#a-memento-minta-megvalositasa-alkalmazasunkban" class="md-nav__link">
    <span class="md-ellipsis">
      A Memento minta megvalósítása alkalmazásunkban
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/bmeviauab00/szoftvertechnikak/edit/master/docs/labor/old-7-tervezesi-mintak/index.md" title="Oldal szerkesztése" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="7-tervezesi-mintak">7. Tervezési minták<a class="headerlink" href="#7-tervezesi-mintak" title="Permanent link">&para;</a></h1>
<h2 id="a-gyakorlat-celja">A gyakorlat célja<a class="headerlink" href="#a-gyakorlat-celja" title="Permanent link">&para;</a></h2>
<p>A gyakorlat céljai:</p>
<ul>
<li>Egy összetettebb példa alapján néhány tervezési minta gyakorlati alkalmazása (elsődlegesen Singleton, Command Processor és Memento).</li>
<li>A Document-View minta további gyakorlása, illetve annak demonstrálása, hogy a mintának több variánsa létezik.</li>
<li>Alapszintű betekintést nyerni az újrafelhasználhatóságot támogató osztálykönyvtárak/keretrendszerek fejlesztésének világába.</li>
<li>Jelentőségüknek megfelelően tovább gyakoroljuk az objektumorientált paradigma legfontosabb koncepcióit (pl. felelősségek különválasztása).</li>
</ul>
<p>Kapcsolódó előadások:</p>
<ul>
<li>Tervezési minták</li>
<li>Szoftver architektúrák témakörből a Document-View architektúra</li>
<li>Windows Forms alkalmazások fejlesztése</li>
</ul>
<h2 id="elofeltetelek">Előfeltételek<a class="headerlink" href="#elofeltetelek" title="Permanent link">&para;</a></h2>
<p>A gyakorlat elvégzéséhez szükséges eszközök:</p>
<ul>
<li>Visual Studio 2022</li>
<li>Windows 10 vagy Windows 11 operációs rendszer (Linux és macOS nem alkalmas)</li>
</ul>
<h2 id="megoldas">Megoldás<a class="headerlink" href="#megoldas" title="Permanent link">&para;</a></h2>
<details>
<summary>A kész megoldás letöltése</summary>
<p><img alt="❗" class="twemoji" src="https://cdn.jsdelivr.net/gh/jdecked/twemoji@15.0.3/assets/svg/2757.svg" title=":exclamation:" /> Lényeges, hogy a labor során a laborvezetőt követve kell dolgozni, tilos (és értelmetlen) a kész megoldás letöltése. Ugyanakkor az utólagos önálló gyakorlás során hasznos lehet a kész megoldás áttekintése, így ezt elérhetővé tesszük.</p>
<p>A megoldás GitHubon érhető el <a href="https://github.com/bmeviauab00/lab-designpattern-kiindulo">itt</a>. A legegyszerűbb mód a letöltésére, ha parancssorból a <code>git clone</code> utasítással leklónozzuk a gépünkre:</p>
<p><code>git clone https://github.com/bmeviauab00/lab-designpattern-kiindulo -b megoldas-refactor-elott</code></p>
<p>Ehhez telepítve kell legyen a gépre a parancssori git, bővebb információ <a href="../../hazi/git-github-github-classroom/#git-telepitese">itt</a>.</p>
</details>
<h2 id="bevezeto">Bevezető<a class="headerlink" href="#bevezeto" title="Permanent link">&para;</a></h2>
<h3 id="elmeleti-hatter">Elméleti háttér<a class="headerlink" href="#elmeleti-hatter" title="Permanent link">&para;</a></h3>
<p>A komplexebb alkalmazások fejlesztése során számos tervezői döntést kell meghoznunk, melyek során több lehetőség közül is választhatunk. Amennyiben ezen pontokban olyan döntéseket hozunk, melyek nem követik az objektumorientált szemléletmód alapelveit, nem tartjuk szem előtt az alkalmazásunk könnyű karbantarthatóságát, illetve egyszerűen megvalósítható továbbfejlesztési lehetőségét, könnyen hamar rémálommá válhat a fejlesztés. Az egyes hibák javítása folyamatosan új hibákat szül. Ezen felül a megrendelői változtatási és bővítési igények a kód nagymértékű folyamatos átírását igénylik ahelyett, hogy a kód pár jól meghatározott pontjában történő bővítésével - a meglévő kód jelentős módosítása nélkül - el tudnánk ezt érni.
A tervezési minták jól bevált megoldásokat mutatnak bizonyos gyakran előforduló tervezési problémákra: ezen megoldások abban segítenek, hogy kódunk könnyebben bővíthető, karbantartható és minél nagyobb mértékben újrafelhasználható legyen.
Ugyanakkor ne essünk át a ló túloldalára: csak akkor érdemes egy adott tervezési mintát bevetni, ha adott esetben valós előnyt jelent az alkalmazása. Ellenkező esetben csak a megvalósítás komplexitását növeli feleslegesen.</p>
<h3 id="a-feladat-ismertetese">A feladat ismertetése<a class="headerlink" href="#a-feladat-ismertetese" title="Permanent link">&para;</a></h3>
<p>A feladatunk egy vektorgrafikus rajzolóprogram kifejlesztése:</p>
<ul>
<li>Az alkalmazásban vektorgrafikus alakzatokat lehet létrehozni, úgymint téglalap, ellipszis stb.</li>
<li>A már létrehozott alakzatokat egy grafikus felületen meg kell jeleníteni (ki kell rajzolni).</li>
<li>A már létrehozott alakzatok fontosabb paramétereit, úgymint koordináták, befoglaló téglalap meg kell jeleníteni egy listában egy információs panelen.</li>
<li>Windows Forms technológiára építve dolgozunk.</li>
<li>Document-View architektúrát követjük, de egyszerre csak egy dokumentum lehet megnyitva (nincsenek dokumentumonként tabfülek vagy ablakok).</li>
<li>Egy adott pontig előkészített környezetet viszünk tovább. A munka mennyiségének kezelhető szinten tartása végett csak bizonyos pontig visszük tovább a fejlesztést, nem valósítjuk meg a teljes értékű megoldást. Az újonnan beszúrandó sorokat az útmutatóban kiemelt háttér jelzi.</li>
</ul>
<h2 id="1-feladat-a-kiindulasi-kornyezet-megismerese">1. Feladat - A kiindulási környezet megismerése<a class="headerlink" href="#1-feladat-a-kiindulasi-kornyezet-megismerese" title="Permanent link">&para;</a></h2>
<p>Klónozzuk le a gyakorlathoz tartozó kiinduló alkalmazás <a href="https://github.com/bmeviauab00/lab-designpattern-kiindulo">repositoryját</a>:</p>
<ul>
<li>Nyissunk egy command prompt-ot,</li>
<li>Navigáljunk el egy tetszőleges mappába, például c:\work\NEPTUN</li>
<li>Adjuk ki a következő parancsot: <code>git clone https://github.com/bmeviauab00/lab-designpattern-kiindulo</code></li>
<li>Nyissuk meg a <em>DesignPatternApp.sln</em> solutiont Visual Studio-ban.</li>
</ul>
<p>Futtassuk az alkalmazást, az alábbihoz hasonló felületet látunk (amennyiben a <em>File/New</em> menüelemet kiválasztjuk):</p>
<p><a class="glightbox" href="images/app-initial-ui.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Kiinduló felület" src="images/app-initial-ui.png" /></a></p>
<p>Ismerkedjünk meg működésének néhány aspektusával:</p>
<ul>
<li>A legtöbb funkció nincs még megvalósítva.</li>
<li>A <em>File/New</em> menüelem valamint a toolbar első gombja egy új dokumentumot hoz létre. Ez már működik, próbáljuk ki.</li>
<li>Mivel új alakzatot jelen pillanatban még nem tudunk létrehozni, a dokumentum a létrejöttét követően nem üres, tartalmaz némi tesztelést szolgáló adatot (két téglalapot és egy ellipszist).</li>
<li>Az alakzatok kirajzolása is meg van valósítva. Ezen felül a jobb oldali információs panelen láthatjuk a már létező alakzatok paramétereit.</li>
<li>Az alakzatok közül egy ki lehet választva: ez piros színnel és szaggatott kék kerettel kerül kirajzolásra, illetve az információs panelen ki is van választva az alakzathoz tartozó sor. Új alakzat kijelölésére az információs panelen a megfelelő sor kiválasztásával van mód. Ezt próbáljuk is ki. Azt tapasztaljuk, hogy változtatáskor a bal oldali grafikus felület is frissül, a kiválasztott alakzat színe piros lesz. Hangsúlyozzuk, hogy ez bizony a klasszikus dokumentum-nézet architektúra alapú megközelítés igényét veti fel: a dokumentumunkhoz két nézet kapcsolódik, melyeket konzisztensen kell tartani.
Megjegyzés: a teljes értékű megoldásban a bal oldali grafikus nézetben is megvalósíthatnánk az egérkattintásra történő kijelölést. Ez jelentősen komplexebbé tenné a későbbi feladataink megvalósítását, így ezt szándékosan kihagyjuk.</li>
</ul>
<h3 id="megvalositando-funkciok">Megvalósítandó funkciók<a class="headerlink" href="#megvalositando-funkciok" title="Permanent link">&para;</a></h3>
<p>A következő funkciókat fogjuk a gyakorlat során megvalósítani:</p>
<ul>
<li>Új téglalap és új ellipszis létrehozása véletlen pozícióban. A funkciók az eszközsávon (toolbar)  és a Tools menü alatt is elérhetők.</li>
<li>Dokumentum tartalmának törlése. Minden alakzatot eltávolít a dokumentumból. File/Clear menüvel elérhető.</li>
<li>Visszavonás (Undo). Az utolsó parancs visszavonása, akárhány lépésig visszamenően. Visszavonja az utolsó parancsot, legyen az valamilyen új alakzat létrehozása, vagy a dokumentum tartalmának törlése. Az eszközsávon és és az Edit/Undo menüvel is elérhető.</li>
</ul>
<h3 id="a-solution-felepitese">A solution felépítése<a class="headerlink" href="#a-solution-felepitese" title="Permanent link">&para;</a></h3>
<p>A következő lépésben a kiinduló kódbázissal fogunk megismerkedni. Gyakorlatilag az architektúránk komponens nézetét tekintjük át ebben a lépésben. A Visual Studio Solution Explorer ablakában megfigyelhető, hogy solutionünk két projektet is tartalmaz.</p>
<ul>
<li><code>AppFx</code>: Egy osztálykönyvtár (egy DLL a kimenete). Az ebben található osztályok általános dokumentumkezelési és parancskezelési szolgáltatásokat valósítanak meg, melyek akár több alkalmazásban is felhasználhatók. Az osztálykönyvtár bevezetésével az elsődleges célunk tehát az újrafelhasználhatóság elérése.</li>
<li><code>DesignPatternApp</code>: A futtatható (.exe) alkalmazásunk projektje, mely épít az <code>AppFx</code> osztálykönyvtárra.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Függőség a projektek között</p>
<p>Visual Studio projektek között mindig csak egyirányú függőség lehet. Jelen esetben a DesignPatternApp épít az <code>AppFx</code> projektre. Ezt a gyakorlatban úgy valósítottuk meg, hogy a DesignPatternApp projektben felvettünk egy referenciát az <code>AppFx</code> projektre. Ettől kezdve az DesignPatternApp-ban elérhetők az <code>AppFx</code> (publikus) osztályai. Fordítva viszont nem igaz az állítás, és ennek elérésére nincs is mód.</p>
</div>
<h3 id="document-view-architektura">Document-View architektúra<a class="headerlink" href="#document-view-architektura" title="Permanent link">&para;</a></h3>
<p>Az alkalmazásunk a Document-View architektúrára épül, annak némiképpen továbbfejlesztett koncepcióját valósítja meg: ahelyett, hogy a nézeteknek egy <code>Update</code> művelete lenne, amelyen keresztül általános változás értesítést kapnak a dokumentumuktól, <strong>a dokumentumok különböző változási eseményeket publikálhatnak: minden nézet arra az eseményre fizet elő, és arról kap értesítést, mely számára érdekes.</strong></p>
<ul>
<li>Az <code>AppFx</code> projekt DocView mappájában található egy <code>Document</code> osztály és egy <code>IView</code> interfész. Nézzük meg őket sorban (nyissuk is meg a forrásfájlt):<ul>
<li><code>Document</code>: Különböző dokumentum típusok ősosztályaként szolgálhat. Többek között van egy nézet listája.
(Megjegyzés: mivel alkalmazásunk a Document-View architektúra egy speciális variánsát használja, a nézet listát az ősből el is hagyhattuk volna).</li>
<li><code>IView</code>: Különböző nézet implementációk közös interfésze. Nincs <code>Update</code> művelet, helyette egy <code>SetDocumentAndRegisterToDocEvents</code> műveletet találunk (ebben kell a nézetnek a dokumentum megfelelő eseményeire beregisztrálnia).</li>
</ul>
</li>
</ul>
<p>A következőkben a <code>DesignPatternApp</code> projekt kapcsolódó osztályait tekintjük át:</p>
<ul>
<li>
<p><code>DrawingDocument</code> osztály</p>
<ul>
<li>Egy <code>shapes</code> nevű listában tárolja az alakzatokat.</li>
<li>A <code>selectedShape</code> az aktuálisan kiválasztott alakzatra mutat.</li>
<li>A dokumentum adatai a <code>Shapes</code>, <code>SelectedShape</code> és <code>SelectedShapeIndex</code> tulajdonságokon keresztül érhetők el a külvilág (pl. nézetek) számára.</li>
<li>A korábban ismertetett koncepciónknak megfelelően a dokumentumunk két eseményt is publikál, melyek C# eseményként vannak megvalósítva:<ul>
<li><code>ShapesChanged</code>: azt jelzi, hogy az alakzatok listája megváltozott, pl. új alakzattal bővült, vagy kikerült egy alakzat a listából, vagy akár egy alakzat adatai változtak meg a listában.</li>
<li><code>SelectionChanged</code>: azt jelzi, hogy egy korábbitól eltérő alakzat került kiválasztásra (mely piros színnel jelenik meg rajzoláskor).</li>
</ul>
</li>
<li>A <code>CreateRect</code> és <code>CreateEllipse</code> műveletek létrehoznak egy megfelelő alakzatot, amit a dokumentum el is tárol (és természetesen el is süti a <code>ShapesChanged</code> eseményt).</li>
</ul>
</li>
<li>
<p><code>ViewBase</code> osztály</p>
<ul>
<li>A nézeteink közös ősosztálya, a kódduplikáció elkerülésére vezettük be. Implementálja az <code>IView</code> interfészt.</li>
<li><code>UserControl</code>-ból származik (hasonló koncepciót már láttunk a megelőző gyakorlat <code>FontEditor</code> példájában).</li>
<li>A <code>document</code> tagváltozóban tárolja a nézetet.</li>
<li>A dokumentum megfelelő eseményeire való fel/leiratkozáshoz bevezeti a <code>RegisterToDocEvents</code> és <code>UnRegisterToDocEvents</code> virtuális műveleteket, a leszármazottakban igény szerint kell implementálni.</li>
</ul>
</li>
<li><code>GraphicsView</code> osztály<ul>
<li>Az alkalmazásunk bal oldali, grafikus nézetének implementációja.</li>
<li>A <code>ViewBase</code>-ből származik, így közvetve ezen osztályunk is egy <code>UserControl</code>.</li>
<li>A <code>RegisterToDocEvents</code> műveletében a dokumentum mindkét eseményére (<code>ShapesChanged</code> és <code>SelectionChanged</code>) előfizet, ugyanazt a <code>DocumentOnShapesChanged</code> eseménykezelő függvényt regisztrálja be. Az eseménykezelőben egy egyszerű <code>Invalidate</code> hívást találunk, mely kikényszeríti a nézetünk újrarajzolását.</li>
<li>Az <code>OnPaint</code> megvalósításának alapelve: minden alakzatra meghívjuk a <code>Draw</code> műveletet, mely gondoskodik a tényleges megjelenítésről.</li>
</ul>
</li>
<li><code>InfoPanel</code> osztály<ul>
<li>Az alkalmazásunk jobb oldali információs panel nézetének implementációja.</li>
<li>Szintén a <code>ViewBase</code>-ből származik, így közvetve ezen osztályunk is egy UserControl.</li>
<li>Az információk megjelenítésére egy <code>ListBox</code> vezérlőt használ.</li>
<li>A <code>RegisterToDocEvents</code> műveletében ő is feliratkozik a dokumentum mindkét eseményére:<ul>
<li>Amikor a dokumentum ShapesChanged eseménye sül el, az InfoPanel <code>Document_ShapesChanged</code> művelete hívódik meg: ebben frissíti a listbox tartalmát a dokumentum aktuális állapotának megfelelően.</li>
<li>Amikor a dokumentum SelectionChanged eseménye sül el, a <code>Document_SelectionChanged</code> hívódik: ebben a listbox megfelelő elemét állítjuk be kiválasztottnak.</li>
</ul>
</li>
<li>Amikor a felhasználó egy új elemet választ ki a listboxban, a <code>listBox_SelectedIndexChanged</code> eseménykezelő hívódik: ebben az <code>App.Instance.SetSelectedShape()</code> hívással az aktuális dokumentumunkban állítjuk át a kiválasztott alakzatot a listbox felhasználó által kiválasztott sorának megfelelően.</li>
</ul>
</li>
<li><code>Shape</code>, <code>Rect</code>, <code>Ellipse</code> osztályok<ul>
<li>A <code>Shape</code> a közös ős, az egyes alakzatok ennek leszármazottai.</li>
<li>A gyakorlat során ezek kódjára éppen csak nézzünk rá, ezek implementációs részletei számunkra most kevésbé izgalmasak.
Megjegyzés: Az egyik feladat megvalósítása során másolatot készítünk majd az alakzatokról. Annak érdekében, hogy az alakzatot és a másolatait össze tudjuk „találtatni”, az egyes alakzatokhoz egy számazonosítót rendelünk (<code>Id</code> tag), mely az alakzat és másolatai esetében ugyanazt az értéket veszi fel.</li>
</ul>
</li>
<li><code>App</code> osztály<ul>
<li>Az alkalmazásunk „root” osztálya, magát az alkalmazást reprezentálja. Szerepe hasonló, mint az előző gyakorlat <code>FontEditor</code> példájában.</li>
<li>Megvalósítása a <code>Singleton</code> tervezési minta fontosabb elveit követi: egy példány létezhet belőle, mely egy statikus <code>Instance</code> nevű tulajdonságon keresztül érhető el, a konstruktora pedig védett.</li>
<li>Mivel alkalmazásunkban egyszerre egy dokumentum lehet megnyitva (ún. SDI, Single Document Interface application), egy jelentős egyszerűsítéssel élhettünk: a dokumentumunkból és mindkét nézet típusunkból egy-egy objektumra van csak szükség. Ezekre az <code>App</code> osztályunkban el is tárolunk egy-egy hivatkozást az alábbi tagváltozókban:
<div class="highlight"><pre><span></span><code><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">DrawingDocument</span><span class="w"> </span><span class="n">document</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">GraphicsView</span><span class="w"> </span><span class="n">graphicsView</span><span class="p">;</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">InfoPanel</span><span class="w"> </span><span class="n">infoPanel</span><span class="p">;</span>
</code></pre></div></li>
<li>Az <code>Initialize</code> műveletben levő <code>CommandBindingManager</code> hívásokra később térünk vissza.</li>
</ul>
</li>
</ul>
<h3 id="command-binding">Command Binding<a class="headerlink" href="#command-binding" title="Permanent link">&para;</a></h3>
<p>A komplex felhasználó felülettel rendelkező alkalmazások esetén gyakran előfordul, hogy ugyanazt a parancsot különböző felhasználói felületelemekhez is hozzá szeretnénk kötni. Például <em>New/Open/Close/Cut/Copy/stb</em>. parancsok a legtöbb alkalmazásban egyaránt elérhetők menüből és eszközsávról is. Vagyis a parancs és a kiváltó felületelemek között egy-több kapcsolat van.  Ilyen esetben egy adott parancs vonatkozásában a következőket kell megvalósítani:</p>
<ul>
<li><strong>Parancs futtatása</strong>. Akármelyik felületelemet is aktiválja a felhasználó, a parancshoz tartozó ugyanazon „eseménykezelő” kódot kell futtatni. Ez a gyakorlatban egy adott függvény meghívását jelenti.</li>
<li><strong>Felületelemek állapotkezelése</strong>. Adott parancs vonatkozásában valamennyi felületelem állapotát konzisztensen kell tartani. Vagyis ha pl. letiltjuk az Undo menüt, mert nincs visszavonható művelet, akkor a visszavonásra szolgáló Undo toolbar gombot is le kell tiltani. Hasonlóképpen, ha egy menüelemet el akarunk rejteni, akkor a kapcsolódó toolbar gombot is rejteni kell. De még felületelemek kijelöltségi állapotát is akarhatjuk szabályozni, erre is él a szabályunk.</li>
</ul>
<p>Nézzünk erre példákat az alkalmazásunkban:</p>
<ol>
<li>Indítsuk el az alkalmazást. Figyeljük meg, hogy a <em>File</em> menü alatt a <em>Save/Save As/Close</em> menüelemek és az ezeknek megfelelő toolbar gombok (a Close a harmadik gomb a toolbaron) is le vannak tiltva: amíg nem hoztunk létre vagy töltöttünk be dokumentumot, ezen parancsok futtatásának nincs értelme.</li>
<li>Hozzunk létre egy új dokumentumot (<em>File/New</em> menü). Ekkor valamennyi, az előző pontban említett felületelem konzisztens módon engedélyezett lesz.</li>
<li>Ha bezárjuk a dokumentumot (<em>File/Close</em> menü), ismét valamennyi felületelem tiltott lesz.</li>
</ol>
<p>Egy komplex alkalmazásban a fenti problémakör egyszerű kezelésére célszerű egy központi megoldást bevezetni. Ezt számos módon lehet implementálni, a legtöbb környezet <strong>Command Binding</strong> néven hivatkozik a koncepcióra. Sajnos az elnevezés tekintetében nincs egységesség: van olyan technológia, mely Command néven nevesíti ezt a technikát. Mi Command minta alatt – a tervezési minták klasszikus nevezéktanát követve – mást fogunk érteni, egy későbbi feladatban térünk majd rá.</p>
<p>A Command Binding minta alapelvei:</p>
<ul>
<li>Minden felhasználói parancshoz egy központi (<code>CommandBinding</code>) objektumot hozunk létre.</li>
<li>Ehhez hozzákötjük a parancs aktiválásakor futtatandó eseménykezelőt.</li>
<li>Hozzákötjük valamennyi aktiváló felületelemet (menü, toolbar gomb stb.)</li>
<li>Segédműveleteket vezetünk be a parancsok tiltására/engedélyezésére/elrejtésére/megjelenítésére.</li>
<li>A parancsokat a könnyű azonosítás érdekében valamilyen egyszerű módon, tipikusan stringgel azonosítjuk.</li>
</ul>
<p>A solutionünk <code>AppFx</code> projektjében találunk támogatást a Command Binding megvalósítására (<code>CommandBinding</code> mappa). A megvalósítás részletei számunkra teljesen érdektelenek, gyakorlaton ne is nézzük a kódját, inkább a felhasználásának módját tekintsük át röviden DesignPatternApp projektünkben:</p>
<ul>
<li>Nézzük meg a <code>CommandName</code> osztályt: minden parancshoz egy string nevet vezettünk be, mely a parancsot azonosítja (pl. "Open", "Undo" stb.).</li>
<li>Inicializálás: a <code>CommandBinding</code> objektumokat a <code>MainForm</code> osztály <code>initCommandBindings</code> műveletben hozzuk létre és kötjük hozzá az egyes menüelemekhez/toolbar gombokhoz. Elég, ha itt egy példát megnézünk a sok előfordulás közül.</li>
<li>Ezt követően adott parancshoz tartozó felületelemek állapotai a <code>CommandBindingManager</code> osztály állapotállító segédfüggvényeivel bármikor kényelmesen állíthatók (pl. <code>EnableCommandBinding</code> tiltáshoz/engedélyezéshez). Nézzük meg, hogyan történik ez a <em>Save/Save As/Close</em> parancsok vonatkozásában:<ul>
<li>Amikor az alkalmazás elindul, a parancsokat az <code>App</code> osztály Initialize műveletében tiltjuk (a false második paraméter jelzi, hogy tiltani akarjuk a vezérlőt):
<div class="highlight"><pre><span></span><code><span class="n">CommandBindingManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">EnableCommandBinding</span><span class="p">(</span>
<span class="w">    </span><span class="n">CommandName</span><span class="p">.</span><span class="n">CloseDocument</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">);</span>
<span class="n">CommandBindingManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">EnableCommandBinding</span><span class="p">(</span>
<span class="w">    </span><span class="n">CommandName</span><span class="p">.</span><span class="n">SaveDocument</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">);</span>
<span class="n">CommandBindingManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">EnableCommandBinding</span><span class="p">(</span>
<span class="w">    </span><span class="n">CommandName</span><span class="p">.</span><span class="n">SaveAsDocument</span><span class="p">,</span><span class="w"> </span><span class="k">false</span><span class="p">);</span>
</code></pre></div></li>
<li>A parancsok engedélyezésére az <code>App.NewDocument</code>-ben látunk példát. Ez a művelet egy parancs eseménykezelője, a többi eseménykezelővel együtt az <code>App.CommandHandlers.cs</code> fájlban található (az <em>App</em> osztály „partial”, több fájlban van megírva).
<div class="highlight"><pre><span></span><code><span class="n">CommandBindingManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">EnableCommandBinding</span><span class="p">(</span>
<span class="w">    </span><span class="n">CommandName</span><span class="p">.</span><span class="n">CloseDocument</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="n">CommandBindingManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">EnableCommandBinding</span><span class="p">(</span>
<span class="w">    </span><span class="n">CommandName</span><span class="p">.</span><span class="n">SaveDocument</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="n">CommandBindingManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">EnableCommandBinding</span><span class="p">(</span>
<span class="w">    </span><span class="n">CommandName</span><span class="p">.</span><span class="n">SaveAsDocument</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
</code></pre></div></li>
</ul>
</li>
</ul>
<p>A további feladatok megvalósítása során is a <code>CommandBindingManager</code> osztályunkat fogjuk használni a parancsok tiltásához és engedélyezéséhez.</p>
<h2 id="2-feladat-command-processor-minta">2. Feladat - Command Processor minta<a class="headerlink" href="#2-feladat-command-processor-minta" title="Permanent link">&para;</a></h2>
<p>A feladat során a <strong>Command</strong>, pontosabban annak továbbfejlesztett változata, a <strong>Command Processor</strong> tervezési minta megvalósítását fogjuk gyakorolni.
Mindkét minta elméleti hátterét a kapcsolódó előadás ismerteti részletesen, UML diagramokkal illusztrálva. A gyakorlat során, és így jelen útmutatóban is csak az elméleti háttér legfontosabb elemeire térünk ki. Lényeges, hogy a mintát ne keverjük a már korábban ismertetett <strong>Command Binding</strong> mintával, mert attól eltérő problémára mutat megoldást.</p>
<h3 id="a-command-processor-minta-koncepcioja">A Command Processor minta koncepciója<a class="headerlink" href="#a-command-processor-minta-koncepcioja" title="Permanent link">&para;</a></h3>
<p><strong>A minta alapelve az, hogy minden felhasználói kérést egy külön parancs (Command) objektumként zár egységbe.</strong> Ezen túlmenően a végrehajtott parancs objektumok eltárolásra kerülnek, ami <strong>lehetővé teszi a korábban végrehajtott parancsok visszavonását</strong>.
A következőkben áttekintjük a minta működését. Első lépésben még nem valósítjuk meg, csak az alapelveire koncentrálunk (bár hogy könnyebben megérthető legyen, a mintát az alkalmazásunkra vetítve mutatjuk be). Következzen egy ábra, majd a hozzá kapcsolódó gondolatok. </p>
<p><a class="glightbox" href="images/command-processor-class-diagram.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Kiinduló felület" src="images/command-processor-class-diagram.png" /></a></p>
<ul>
<li>Bevezetünk egy <code>Command</code> ősosztályt vagy interfészt, melynek van egy <code>Execute</code> és egy <code>UnExecute</code> absztrakt művelete (vagy nevezhetjük <code>Do</code> és <code>Undo</code>-nak is őket, ha úgy tartja kedvünk).</li>
<li>Az egyes felhasználói parancsokhoz bevezetünk egy Command leszármazott osztályt.<ul>
<li>Első körben a New Rect és New Ellipse parancsokra vonatkozóan kívánunk Undo támogatást bevezetni, így ezekhez vezetünk majd rövidesen be egy-egy új osztályt, pl. <code>NewRectCommand</code> és <code>NewEllipseCommand</code> néven.</li>
<li>Ezen osztályokban a parancsspecifikusan megírjuk az <code>Execute</code> műveletet (pl. a <code>NewRectCommand.Execute</code>-ban felveszünk a dokumentumunkban egy új téglalapot), az <code>UnExecute</code>-ban pedig visszacsináljuk a művelet hatását. </li>
<li>A <code>Command</code> leszármazott osztályok sokszor nem maguk valósítják meg funkciójukat, hanem delegálják azt egy vagy több másik osztálynak. Ezt az osztályt az UML diagramon Receiver néven tüntettük fel. A gyakorlatban nem így szoktuk hívni. Alkalmazásunkban a Command-ok tipikusan az <code>App</code> osztályba hívnak tovább, vagyis esetünkben az <code>App</code> felel meg legtöbb esetben az ábrán szereplő Receiver osztálynak.</li>
</ul>
</li>
<li>Bevezetünk egy központi <code>CommandProcessor</code> osztályt két művelettel:<ul>
<li><code>ExecuteCommand</code>: végrehajtja a paraméterül kapott parancsot (meghívja az <code>Execute</code> műveletét), majd eltárolja egy belső stack gyűjteményben.</li>
<li><code>UnExecuteLastCommand</code>: kiveszi az utoljára végrehajtott parancsot a command stack-ből, és meghívja annak <code>UnExecute</code> műveletét. Ezzel gyakorlatilag a parancs visszavonás funkcióját (Undo) valósítja meg.</li>
</ul>
</li>
</ul>
<p>Lényeges, hogy a <strong>Command Binding mintával ellentétben itt a parancsok minden egyes futtatásához új Command objektumot hozunk létre</strong>, vagyis ha pl. háromszor „futtatjuk" a <code>NewRectCommand</code> parancsot, akkor három <code>NewRectCommand</code> objektumot hozunk ehhez létre. Ennek oka az, hogy a <code>CommandProcessor</code> command stack-jében három parancsobjektumot kell eltárolni (hiszen ezeket egymástól függetlenül akarjuk visszavonni Undo esetén).</p>
<h3 id="a-command-processor-minta-megvalositasa-alkalmazasunkban">A Command Processor minta megvalósítása alkalmazásunkban<a class="headerlink" href="#a-command-processor-minta-megvalositasa-alkalmazasunkban" title="Permanent link">&para;</a></h3>
<p>Kövessük az alábbi lépéseket:</p>
<ol>
<li>Az <code>AppFx</code> projekt Command mappájában már létezik egy absztrakt <code>Command</code> osztály, így ezzel nincs teendőnk.</li>
<li>A <code>Command</code> mappában vegyük fel a parancsok menedzseléséért felelős az általános <code>CommandProcessor</code> osztályt:
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">CommandProcessor</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;</span><span class="w"> </span><span class="n">commands</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;</span><span class="p">();</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ExecuteCommand</span><span class="p">(</span><span class="n">Command</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">cmd</span><span class="p">.</span><span class="n">Execute</span><span class="p">();</span>
<span class="w">        </span><span class="n">commands</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UnExecuteLastCommand</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Ha üres, nem csinálunk semmit</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">commands</span><span class="p">.</span><span class="n">Any</span><span class="p">())</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>

<span class="w">        </span><span class="n">Command</span><span class="w"> </span><span class="n">lastCommand</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="n">Pop</span><span class="p">();</span>
<span class="w">        </span><span class="n">lastCommand</span><span class="p">.</span><span class="n">UnExecute</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Clear</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="n">commands</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">HasAny</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">commands</span><span class="p">.</span><span class="n">Any</span><span class="p">();</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
A megvalósítás során a .NET beépített <code>Stack&lt;T&gt;</code> osztályát használjuk a command stack megvalósítására. A metódusok implementációja egyszerű, a korábban ismertetett logikát követi.</li>
<li>Integráljuk be a <code>CommandProcessor</code> osztályt az alkalmazásunkba. Vegyünk fel egy tagváltozót az <code>App</code> osztályba:
<div class="highlight"><pre><span></span><code><span class="k">readonly</span><span class="w"> </span><span class="n">CommandProcessor</span><span class="w"> </span><span class="n">commandProcessor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">CommandProcessor</span><span class="p">();</span>
</code></pre></div>
Annak érdekében, hogy ez forduljon, a forrásfájlban az <code>AppFx.Command</code> névteret „using-olni” kell.</li>
<li>Az <code>App.CommandHandlers.cs</code>-be a <code>CloseDocument</code> végére vegyük fel ezt a sort:
<div class="highlight"><pre><span></span><code><span class="n">commandProcessor</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</code></pre></div>
Ennek az a szerepe, hogy amikor bezárjuk a dokumentumot, kipucoljuk az undo sort, hiszen a benne levő elemek egy már bezárt, nem létező dokumentumra vonatkoznak.</li>
<li>Amikor egy parancsot futtatunk vagy visszavonunk, az Undo menüt és toolbar gombot is megfelelően tiltani vagy engedélyezni kell: ha van legalább egy command a command stack-en, akkor engedélyezzük, egyébként tiltjuk. Vezessünk be egy-egy segédfüggvényt az App osztályba a parancsok futtatásához és visszavonásához, melyek a korábban ismertetett CommandBindingManager osztályunk segítségével gondoskodnak az Undo tiltásáról/engedélyezéséről is:
<div class="highlight"><pre><span></span><code><span class="k">void</span><span class="w"> </span><span class="nf">executeCommand</span><span class="p">(</span><span class="n">Command</span><span class="w"> </span><span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">commandProcessor</span><span class="p">.</span><span class="n">ExecuteCommand</span><span class="p">(</span><span class="n">cmd</span><span class="p">);</span>
<span class="w">    </span><span class="n">CommandBindingManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">EnableCommandBinding</span><span class="p">(</span>
<span class="w">                    </span><span class="n">CommandName</span><span class="p">.</span><span class="n">Undo</span><span class="p">,</span><span class="w"> </span><span class="n">commandProcessor</span><span class="p">.</span><span class="n">HasAny</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">void</span><span class="w"> </span><span class="nf">unexecuteLastCommand</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">commandProcessor</span><span class="p">.</span><span class="n">UnExecuteLastCommand</span><span class="p">();</span>
<span class="w">    </span><span class="n">CommandBindingManager</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">EnableCommandBinding</span><span class="p">(</span>
<span class="w">                    </span><span class="n">CommandName</span><span class="p">.</span><span class="n">Undo</span><span class="p">,</span><span class="w"> </span><span class="n">commandProcessor</span><span class="p">.</span><span class="n">HasAny</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Az <code>unexecuteLastCommand</code> műveletet akkor kell meghívni, amikor a felhasználó az Undo funkciót aktiválja. Az <code>App.CommandHandlers.cs</code> fájlban levő UndoLast metódus egy <code>CommandBinding</code> segítségével már hozzá van kötve a felületelemekhez (Undo menü és toolbar gomb), így aktiválásukkor meg is hívódik. Már csak az a dolgunk, hogy átírjuk az <code>UndoLast</code> törzsét:
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UndoLast</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">unexecuteLastCommand</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></li>
<li>A következő lépésekben Command leszármazott osztályokat hozunk létre az egyes alkalmazásspecifikus parancsokhoz. A <code>DesignPatternApp</code> projektben vegyünk fel egy <code>Commands</code> nevű mappát (jobb katt a projekten, Add/New Folder menü), ebbe fogjuk az ide tartozó osztályokat összegyűjteni.</li>
<li>Ebbe a <code>Commands</code> mappába vegyünk fel egy <code>NewRectCommand</code> osztályt a „New Rect” funkció megvalósításához, a következő kóddal:
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">AppFx.Command</span><span class="p">;</span>
<span class="err">…</span>

<span class="k">class</span><span class="w"> </span><span class="nc">NewRectCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">shapeId</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">shapeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">CreateRandomRect</span><span class="p">().</span><span class="n">Id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UnExecute</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">RemoveShape</span><span class="p">(</span><span class="n">shapeId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
Az <code>Execute</code> művelet meghívja az <code>App</code> singleton <code>CreateRandomRect</code> műveletét, amely felvesz egy új <code>Rectangle</code> objektumot a dokumentumban, véletlenszerűen generált befoglaló téglalapban, és visszatér vele. Az újonnan létrehozott <code>Rect</code> objektumra a <code>NewRectCommand</code> eltárolja az alakzat azonosítóját a <code>shapeId</code> tagváltozóban. (Jelen pillanatban egy referencia tárolása is elég lenne, de mikor később a <strong>Memento</strong> megvalósítása során másolatot készítünk az alakzat objektumokról, a referencia használata már nem jelentene megoldást.)
Az <code>UnExecute</code> műveletben az App singleton <code>RemoveShape</code> műveletének segítségével eltávolítjuk a parancs által létrehozott alakzatot, így visszavonjuk annak hatását (nézzük meg a kódban, hogyan van megvalósítva).</li>
<li>Vegyünk fel a <code>Commands</code> mappába egy <code>NewEllipseCommand</code> osztályt, és implementáljuk a <code>NewRectCommand</code>-hoz hasonló elveknek megfelelően:
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">AppFx.Command</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">NewEllipseCommand</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">Command</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">shapeId</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">shapeId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">CreateRandomEllipse</span><span class="p">().</span><span class="n">Id</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UnExecute</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">RemoveShape</span><span class="p">(</span><span class="n">shapeId</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
<li>A <code>NewRectCommand</code> és <code>NewEllipseCommand</code> osztályainkat még nem használjuk sehol, most ezek bevetése következik. Amikor a felhasználó akár menüből, akár toolbarról aktiválja a New Rect funkciót, létre kell hozzunk egy NewRectCommand objektumot, és futtatni kell segédműveleteink felhasználásával. Keressük meg az <code>App.CommandHandlers.cs</code> fájlban a <code>NewRect</code> metódust. Ez egy <code>CommandBinding</code> segítségével már rá van kötve a megfelelő menüre/toolbar gombra, csak a törzsében levő <code>showNotImplemented()</code> hívást kell lecserélni:
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">DesignPatternApp.Commands</span><span class="p">;</span>
<span class="err">…</span>
<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">NewRect</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">executeCommand</span><span class="p">(</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NewRectCommand</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
Ehhez hasonlóan alakítsuk át a <code>NewRect</code> mellett található <code>NewEllipse</code> műveletet is:
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">NewEllipse</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">executeCommand</span><span class="p">(</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">NewEllipseCommand</span><span class="p">()</span><span class="w"> </span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></li>
<li>Mostantól tudunk új alakzatokat létrehozni, így új dokumentum létrehozásakor tesztadatok automatikus felvételére nincs szükség: az App.NewDocument műveletben kommentezzük ki az <code>addTestData</code> hívását.</li>
</ol>
<p>Elkészültünk, teszteljük a megoldásunkat:</p>
<ol>
<li>Futtassuk az alkalmazást, és hozzunk létre egy dokumentumot.</li>
<li>Figyeljük meg, hogy az Undo parancs (toolbar és menü is) tiltva van.</li>
<li>A <em>New Rect</em> paranccsal hozzunk létre egy új téglalapot. A téglalap megjelenik, és az Undo parancs engedélyezett lesz.</li>
<li>Hozzunk létre néhány további alakzatot, téglalapot és ellipszist vegyesen.</li>
<li>Az <em>Undo</em> funkció használatával vonjuk vissza a műveleteket mindaddig, amíg nem marad alakzat: ekkor az Undo parancs letiltásra kerül.</li>
</ol>
<p>Amennyiben a gyakorlat során jól állunk idővel, a kódot lépésenként futtatva is nézzük vissza megoldásunk működését:</p>
<ol>
<li>Tegyünk egy töréspontot az <code>App.CommandHandlers.cs</code>-ben található <code>NewRect</code> és <code>UndoLast</code> műveletek törzsébe (mindkét művelet egysoros).</li>
<li>Indítsuk el debug módban az alkalmazást (<span class="keys"><kbd class="key-f5">F5</kbd></span>).</li>
<li>Hozzunk létre egy dokumentumot, majd egy téglalapot. A <code>NewRect</code> kódjából kiindulva az <span class="keys"><kbd class="key-f11">F11</kbd></span> billentyűvel az <code>executeCommand</code> és a <code>CommandProcessor</code> műveleteibe belelépve „értelmezzük” megoldásunkat.</li>
<li>Ezt követően vonjuk vissza az utolsó műveletet. Ekkor az <code>UndoLast</code> műveletből kiindulva lépkedjünk végig a kódunkon.</li>
</ol>
<h2 id="3-feladat-memento-minta">3. Feladat – Memento minta<a class="headerlink" href="#3-feladat-memento-minta" title="Permanent link">&para;</a></h2>
<p>A feladatban a <strong>Memento</strong> minta megvalósítását gyakoroljuk. A minta teljes elméleti háttere – UML diagramokkal illusztrálva - előadáson kerül ismertetésre, itt a minta legfontosabb elemeire koncentrálunk.</p>
<h3 id="a-memento-minta-koncepcioja">A Memento minta koncepciója<a class="headerlink" href="#a-memento-minta-koncepcioja" title="Permanent link">&para;</a></h3>
<p>Előző feladatunkban a <em>New Rect</em> és <em>New Ellipse</em> parancsok visszavonását könnyen meg tudtuk valósítani: mindössze el kellett távolítani a parancs által létrehozott alakzatot a dokumentum alakzatlistájából. A command objektumainkban ehhez elég volt egy azonosítót eltárolni az újonnan létrehozott alakzatra.</p>
<p>Az alkalmazások többségénél azonban számos olyan parancs felbukkanhat, mely a dokumentum állapotát jelentős mértékben befolyásolja. Ilyenkor a parancsnak a végrehajtás előtt a dokumentum állapotának jelentős részéhez, vagy akár a teljes állapotához is hozzá kell férnie, hogy eltudja azt menteni az UnExecute megvalósításához. Ez úgy lehetséges, ha a dokumentum teljes állapotát publikussá tesszük. Ez viszont nem szerencsés, mert ellentmond az egységbezárás elvének. Nem szeretnénk a teljes állapotot – ráadásul módosításra vonatkozóan is – hozzáférhetővé tenni a külvilág számára, csak a visszavonás kedvéért.  Erre a problémára nyújt megoldást a <strong>Memento</strong> tervezési minta.</p>
<p>Alapelve egy mondatban: <strong>dokumentumunk állapotát egy ún. Memento objektumba csomagoljuk be, hogy az később a visszavonás során visszaállítható legyen</strong>.</p>
<p>Következzen egy ábra, majd a hozzá kapcsolódó gondolatok.</p>
<p><a class="glightbox" href="images/memento-class-diagram.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="Kiinduló felület" src="images/memento-class-diagram.png" /></a></p>
<p>Alapelve részletesebben:
- Az <code>Originator</code> azon osztály, melynek az állapotához hozzá szeretnénk férni. Esetünkben ez a <code>DrawingDocument</code> osztály tölti be az <code>Originator</code> szerepét. Az állapotot összefogóan az ábra a <code>state:State</code> taggal jelöli. Esetünkben ez a <code>shapes</code> lista, valamint a <code>selectedShape</code> tag lesz.  A következő lépésektől a mintát az alkalmazásunkra vetítjük.
- A dokumentumunk állapotát (esetünkben ez a <code>shapes</code> lista, valamit a <code>selectedShape</code> tag) <strong>NEM</strong> tesszük publikussá.
- A dokumentumunkban bevezetünk egy <code>CreateMemento</code> műveletet, mely egy ún. <code>Memento</code> objektumot hoz létre. A <code>Memento</code> tagváltozóiban a dokumentum állapotának pillanatnyi képét tartalmazza (vagyis tulajdonképpen egy csomagoló objektum a dokumentum aktuális állapotához).
- A dokumentum állapotának visszaállítására bevezetünk a dokumentumban egy <code>RestoreFromMemento</code> műveletet, mely paraméterként egy <code>Memento</code> objektumot kap. A dokumentum ebben a műveletben visszaállítja saját állapotát a paraméterként kapott <code>Memento</code> objektum alapján.</p>
<h3 id="a-memento-minta-megvalositasa-alkalmazasunkban">A Memento minta megvalósítása alkalmazásunkban<a class="headerlink" href="#a-memento-minta-megvalositasa-alkalmazasunkban" title="Permanent link">&para;</a></h3>
<p>Alkalmazásunkban a <em>Clear</em> funkciót valósítjuk meg a Memento mintára építve. A <em>Clear</em> parancs törli a dokumentumból az összes alakzatot. Annak érdekéken, hogy ez visszavonható legyen, a dokumentumunk teljes állapotát el kell menteni a parancs végrehajtása előtt. Ehhez a <code>DrawingDocument</code> osztályunk állapotát jelentő shapes tagot NEM fogjuk publikussá tenni. Még közvetve, property-n/műveleten keresztül sem tesszük módosíthatóvá!</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Amennyiben kevés idő maradt gyakorlaton, nyissuk meg a kész megoldást, és abban mutassuk be a megvalósítás részleteit!</p>
</div>
<ul>
<li>
<p>A dokumentum állapotát tároló Memento osztályt egy a <code>DrawingDocument</code>-be beágyazott osztályként valósítjuk meg, ezzel is hangsúlyozva, hogy <code>Memento</code> osztályunk nagyon szorosan kapcsolódik a dokumentumhoz.
Forráskód szintjén viszont igyekszünk leválasztani, így a DrawingDocument osztályt partial class-ra alakítva külön fájlban dolgozunk.</p>
<ul>
<li>Alakítsuk a <code>DrawingDocument</code>-et partial class-á:
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DrawingDocument</span>
</code></pre></div></li>
<li>Vegyünk fel egy <code>DrawingDocument.Memento.cs</code> fájlt a <code>DesignPatternApp</code> projektbe (jobb katt a projekten, <em>Add/New</em> Item, és a megjelenő ablakban a <em>Code File</em>-t válasszuk ki).</li>
<li>
<p>Illesszük be az alábbi kódrészletet a fájlba:</p>
<details class="abstract">
<summary>DrawingDocument.Memento.cs</summary>
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">System.Collections.Generic</span><span class="p">;</span>

<span class="k">namespace</span><span class="w"> </span><span class="nn">DesignPatternApp</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">partial</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">DrawingDocument</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Memento</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="k">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shapes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">            </span><span class="k">private</span><span class="w"> </span><span class="n">Shape</span><span class="w"> </span><span class="n">selectedShape</span><span class="p">;</span>

<span class="w">            </span><span class="k">public</span><span class="w"> </span><span class="nf">Memento</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shapes</span><span class="p">,</span><span class="w"> </span><span class="n">Shape</span><span class="w"> </span><span class="n">selectedShape</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="c1">// Deep copyra van szükségünk!</span>
<span class="w">                </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="n">Shape</span><span class="w"> </span><span class="n">shape</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">shapes</span><span class="p">)</span>
<span class="w">                    </span><span class="k">this</span><span class="p">.</span><span class="n">shapes</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">shape</span><span class="p">.</span><span class="n">CreateCopy</span><span class="p">());</span>

<span class="w">                </span><span class="c1">// Be kell állítsuk selectedShape-nek. Az új Shape listában kell a megfelelõ</span>
<span class="w">                </span><span class="c1">// elemre hivatkoznia, nem az eredetiben. Be kell állítsuk.</span>
<span class="w">                </span><span class="k">this</span><span class="p">.</span><span class="n">selectedShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>
<span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">shapes</span><span class="p">.</span><span class="n">Count</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">shapes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">selectedShape</span><span class="p">)</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="k">this</span><span class="p">.</span><span class="n">selectedShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">shapes</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<span class="w">                        </span><span class="k">break</span><span class="p">;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">            </span><span class="p">}</span>

<span class="w">            </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">GetState</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Shape</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shapes</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">Shape</span><span class="w"> </span><span class="n">selectedShape</span><span class="p">)</span>
<span class="w">            </span><span class="p">{</span>
<span class="w">                </span><span class="n">shapes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">shapes</span><span class="p">;</span>
<span class="w">                </span><span class="n">selectedShape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="n">selectedShape</span><span class="p">;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">}</span>

<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</details>
</li>
</ul>
</li>
<li>
<p>A <code>Memento</code> osztályunk legfontosabb aspektusai:</p>
<ul>
<li>Pontosan olyan tagváltozói vannak, mint a dokumentum osztályunknak: így tudja annak teljes állapotát eltárolni.</li>
<li>Konstruktorában a dokumentum állapotváltozóit várja (<code>shapes</code> és <code>selectedShape</code>). Lényeges, hogy a <code>shapes</code> listáról deep-copy másolatot készít: ha csak referenciákat tárolna a dokumentumban levő objektumokra, akkor a dokumentum változásával a memento objektumunk állapota is változna. Nekünk viszont az aktuális állapot megőrzése a célunk.</li>
<li>A <code>GetState</code>-ben két out paraméterben visszaadja az elmentett állapotot. Az <em>Undo</em> művelet során fogjuk ezt használni.</li>
</ul>
</li>
<li>
<p>Emeljük be az alábbi kódrészletet a <code>DrawingDocument.cs</code> fájlba a <code>DrawingDocument</code> osztályba:</p>
<details class="abstract">
<summary>DrawingDocument.cs fájlba</summary>
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="n">Memento</span><span class="w"> </span><span class="nf">CreateMemento</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nf">Memento</span><span class="p">(</span><span class="n">shapes</span><span class="p">,</span><span class="w"> </span><span class="n">selectedShape</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RestoreFromMemento</span><span class="p">(</span><span class="n">Memento</span><span class="w"> </span><span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">m</span><span class="p">.</span><span class="n">GetState</span><span class="p">(</span><span class="k">out</span><span class="w"> </span><span class="n">shapes</span><span class="p">,</span><span class="w"> </span><span class="k">out</span><span class="w"> </span><span class="n">selectedShape</span><span class="p">);</span>
<span class="w">    </span><span class="n">fireShapesChanged</span><span class="p">();</span>
<span class="w">    </span><span class="n">fireSelectionChanged</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
</details>
<p>A <code>CreateMemento</code> művelet a mintának megfelelően legyárt egy <code>Memento</code> objektumot a dokumentum állapotáról. A <code>RestoreFromMemento</code> pedig a paraméterül kapott <code>Memento</code> objektum alapján visszaállítja a dokumentum állapotát.</p>
</li>
</ul>
<p>Ezzel a Memento támogatás beépítésével végeztünk. Ugyanakkor jelen pillanatban egyetlen parancsunk sem használja ezt a szolgáltatást.  Mint korábban említettük, a <em>Clear</em> funkciót valósítjuk meg a Memento mintára építve.</p>
<ul>
<li>Vegyünk fel egy <code>ClearCommand</code> osztályt a <code>DesignPatternApp</code> projekt <code>Commands</code> mappájában.</li>
<li>
<p>Emeljük be az alábbi kódrészletet az új <code>ClearCommand.cs</code> fájlba:</p>
<details class="abstract">
<summary>ClearCommand.cs</summary>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">ClearCommand</span><span class="p">:</span><span class="w"> </span><span class="n">Command</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">DrawingDocument</span><span class="p">.</span><span class="n">Memento</span><span class="w"> </span><span class="n">memento</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">null</span><span class="p">;</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">Document</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>

<span class="w">        </span><span class="n">memento</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="n">CreateMemento</span><span class="p">();</span>
<span class="w">        </span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UnExecute</span><span class="p">()</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">Document</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">null</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="p">;</span>

<span class="w">        </span><span class="n">App</span><span class="p">.</span><span class="n">Instance</span><span class="p">.</span><span class="n">Document</span><span class="p">.</span><span class="n">RestoreFromMemento</span><span class="p">(</span><span class="n">memento</span><span class="p">);</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</details>
</li>
<li>
<p>Vegyük fel a fájl elejére ez alábbi sort:
<div class="highlight"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="nn">AppFx.Command</span><span class="p">;</span>
</code></pre></div></p>
</li>
<li>Az <code>App.CommandHandlers.cs</code> fájlban a <code>ClearDocument</code> műveletet írjuk át, hogy most már az újonnan létrehozott <code>ClearCommand</code> parancsunkat „futtassa”:
<div class="highlight"><pre><span></span><code><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ClearDocument</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">executeCommand</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">ClearCommand</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<p>Teszteljük megoldásunkat:</p>
<ul>
<li>Futtassuk az alkalmazást,</li>
<li>Hozzunk létre pár alakzatot,</li>
<li>A File/Clear menüből futtassuk a <em>Clear</em> parancsot: az alakzataink eltűnnek.</li>
<li>Az <em>Undo</em> paranccsal vonjuk vissza a parancsot: az alakzatok újra megjelennek.</li>
</ul>
<p>Lépésenként futtatva is teszteljük a megoldást:</p>
<ul>
<li>Tegyünk egy töréspontot a <code>ClearCommand.Execute</code> művelet első sorára.</li>
<li>Indítsuk ez az alkalmazást, hozzunk létre pár alakzatot, majd a <em>File/Clear</em> menüből futtassuk a <em>Clear</em> parancsot.</li>
<li>Mikor a kódunk megáll a töréspontnál, lépkedjük el a <code>CreateMemento</code> hívásáig, és lépjünk is át rajta. A <code>CreateMemento</code> által visszaadott memento objektum belső állapotát nézzük meg vagy a Watch ablakban, vagy tooltipben ráállva. Azt látjuk, hogy valóban „tartalmazza” a dokumentum pillanatnyi állapotát a shapes és <code>selectedShape</code> tagváltozójában. A <code>ClearCommand</code> ezt el is tárolja a tagváltozójában, amit az <code>UnExecute</code> műveletben használ fel a dokumentum állapotának visszaállítására.</li>
</ul>
<p>Példánkban a Memento minta arra épít, hogy a dokumentum teljes állapotáról másolatot készítünk. Sok alkalmazás, illetve nagyméretű dokumentum esetében ennek nagyon nagy lehet a memóriaigénye. Milyen megoldásokban gondolkozhatunk a probléma elkerülésére?</p>
<ul>
<li>A kisebb változások hatását inkább „inverz” művelettel próbáljuk visszacsinálni. Ezt alkalmaztuk pl. a <em>New Rect</em> parancs esetében.</li>
<li>A Memento-ba nem mentjük bele a teljes állapotot, hanem csak módosult állapotot. Sajnos ez nem mindig tehető meg, valamint nehezebben karbantartható megoldást eredményez.</li>
<li>Korlátozzuk a visszavonható lépések számát.</li>
</ul>
<hr>
<div class="md-source-file">
  <span class="md-source-file__fact"> <span class="md-icon" title="Utolsó frissítés"> <svg
        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z">
        </path>
      </svg>
    </span>
    <span title="2023. december 21. 11:38:40">
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-timeago" title="2023. december 21. 11:38:40"><span class="timeago" datetime="2023-12-21T11:38:40+01:00" locale="hu"></span></span><span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_date" title="2023. december 21. 11:38:40">2023-12-21</span>
    </span>
  </span>

  

  <span class="md-source-file__fact">
    <span class="md-icon" title="Szerzők">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path
          d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z">
        </path>
      </svg>
    </span>
    <span>Szerzők</span>
    <nav><a href="https://github.com/bzolka" target="_blank" rel="noopener noreferrer" class="md-author" title="@bzolka">
        <img src="https://avatars.githubusercontent.com/bzolka?size=72" alt="@bzolka">
      </a><a href="https://github.com/homok43" target="_blank" rel="noopener noreferrer" class="md-author" title="@None">
        <img src="https://avatars.githubusercontent.com/u/16989201?u=0e27954064045c1000b2eccf6dbf2cd8b33e2b0f&v=4?size=72" alt="@None">
      </a><a href="https://github.com/zbenedek-mirango" target="_blank" rel="noopener noreferrer" class="md-author" title="@Zoltán Benedek">
        <img src="https://avatars.githubusercontent.com/u/105201689?u=f025d5bedc2ea0cab45a1010194e95afd8ed3556&v=4?size=72" alt="@Zoltán Benedek">
      </a></nav>      
  </span>
</div>




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Vissza a tetejére
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; BME VIK AUT
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.instant", "navigation.top", "search.suggest", "content.action.edit", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "V\u00e1g\u00f3lapra m\u00e1solva", "clipboard.copy": "M\u00e1sol\u00e1s v\u00e1g\u00f3lapra", "search.result.more.one": "1 tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.more.other": "# tov\u00e1bbi tal\u00e1lat az oldalon", "search.result.none": "Nincs tal\u00e1lat", "search.result.one": "1 egyez\u0151 dokumentum", "search.result.other": "# egyez\u0151 dokumentum", "search.result.placeholder": "Keres\u00e9shez \u00edrj ide valamit", "search.result.term.missing": "\u00dcres", "select.version": "Verzi\u00f3v\u00e1lt\u00e1s"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.8fd75fb4.min.js"></script>
      
        <script src="../../js/timeago.min.js"></script>
      
        <script src="../../js/timeago_mkdocs_material.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>